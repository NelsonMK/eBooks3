            <div class="footer">
                <!-- Begin Footer Static Top Area -->
                <div class="footer-static-top">
                    <div class="container">
                        <!-- Begin Footer Shipping Area -->
                        <div class="footer-shipping pt-60 pb-25">
                            <div class="row">
                                <!-- Begin Li's Shipping Inner Box Area -->
                                <div class="col-lg-3 col-md-6 col-sm-6 pb-sm-55 pb-xs-55">
                                    <div class="li-shipping-inner-box">
                                        <div class="shipping-icon">
                                            <img src="<?php echo site_assets() ?>images/shipping-icon/1.png" alt="Shipping Icon">
                                        </div>
                                        <div class="shipping-text">
                                            <h2>Quick Delivery</h2>
                                            <p>Your books are delivered as soon as your payment is confirmed.</p>
                                        </div>
                                    </div>
                                </div>
                                <!-- Li's Shipping Inner Box Area End Here -->
                                <!-- Begin Li's Shipping Inner Box Area -->
                                <div class="col-lg-3 col-md-6 col-sm-6 pb-sm-55 pb-xs-55">
                                    <div class="li-shipping-inner-box">
                                        <div class="shipping-icon">
                                            <img src="<?php echo site_assets() ?>images/shipping-icon/2.png" alt="Shipping Icon">
                                        </div>
                                        <div class="shipping-text">
                                            <h2>Safe Payment</h2>
                                            <p>Pay with the world's most popular and secure payment methods.</p>
                                        </div>
                                    </div>
                                </div>
                                <!-- Li's Shipping Inner Box Area End Here -->
                                <!-- Begin Li's Shipping Inner Box Area -->
                                <div class="col-lg-3 col-md-6 col-sm-6 pb-xs-30">
                                    <div class="li-shipping-inner-box">
                                        <div class="shipping-icon">
                                            <img src="<?php echo site_assets() ?>images/shipping-icon/3.png" alt="Shipping Icon">
                                        </div>
                                        <div class="shipping-text">
                                            <h2>Shop with Confidence</h2>
                                            <p>Our Buyer Protection covers your purchase from click to delivery.</p>
                                        </div>
                                    </div>
                                </div>
                                <!-- Li's Shipping Inner Box Area End Here -->
                                <!-- Begin Li's Shipping Inner Box Area -->
                                <div class="col-lg-3 col-md-6 col-sm-6 pb-xs-30">
                                    <div class="li-shipping-inner-box">
                                        <div class="shipping-icon">
                                            <img src="<?php echo site_assets() ?>images/shipping-icon/4.png" alt="Shipping Icon">
                                        </div>
                                        <div class="shipping-text">
                                            <h2>24/7 Help Center</h2>
                                            <p>Have a question? Contact Us.</p>
                                        </div>
                                    </div>
                                </div>
                                <!-- Li's Shipping Inner Box Area End Here -->
                            </div>
                        </div>
                        <!-- Footer Shipping Area End Here -->
                    </div>
                </div>
                <!-- Footer Static Top Area End Here -->
                <!-- Begin Footer Static Middle Area -->
                <div class="footer-static-middle">
                    <div class="container">
                        <div class="footer-logo-wrap pt-50 pb-35">
                            <div class="row">
                                <!-- Begin Footer Logo Area -->
                                <div class="col-lg-4 col-md-6">
                                    <div class="footer-logo">
                                        <!--<img src="<?php echo footer_logo() ?>1.jpg" alt="Footer Logo">-->
                                        <p class="info">
                                            Delivering the best books
                                        </p>
                                    </div>
                                    <ul class="des">
                                        <li>
                                            <span>Address: </span>
                                            Ndagani, Chuka
                                        </li>
                                        <li>
                                            <span>Phone: </span>
                                            <a href="tel://+254 721 589 890">+254 721 589 890</a>
                                        </li>
                                        <li>
                                            <span>Email: </span>
                                            <a href="mailto://kimathigeorge27@gmail.com">kimathigeorge27@gmail.com</a>
                                        </li>
                                    </ul>
                                </div>
                                <!-- Footer Logo Area End Here -->
                                <!-- Begin Footer Block Area -->
                                <div  class="col-lg-2 col-md-3 col-sm-6">
                                    <div style="display: none;" class="footer-block">
                                        <h3 class="footer-block-title">Product</h3>
                                        <ul>
                                            <li><a href="#">Prices drop</a></li>
                                            <li><a href="#">New products</a></li>
                                            <li><a href="#">Best sales</a></li>
                                            <li><a href="#">Contact us</a></li>
                                        </ul>
                                    </div>
                                </div>
                                <!-- Footer Block Area End Here -->
                                <!-- Begin Footer Block Area -->
                                <div class="col-lg-2 col-md-3 col-sm-6">
                                    <div style="display: none;" class="footer-block">
                                        <h3 class="footer-block-title">Our company</h3>
                                        <ul>
                                            <li><a href="#">Delivery</a></li>
                                            <li><a href="#">Legal Notice</a></li>
                                            <li><a href="#">About us</a></li>
                                            <li><a href="#">Contact us</a></li>
                                        </ul>
                                    </div>
                                </div>
                                <!-- Footer Block Area End Here -->
                                <!-- Begin Footer Block Area -->
                                <div class="col-lg-4">
                                    <div class="footer-block">
                                        <h3 class="footer-block-title">Follow Us</h3>
                                        <ul class="social-link">
                                            <li class="twitter">
                                                <a href="https://twitter.com/" data-toggle="tooltip" target="_blank" title="Twitter">
                                                    <i class="fa fa-twitter"></i>
                                                </a>
                                            </li>
                                            <li class="facebook">
                                                <a href="https://www.facebook.com/" data-toggle="tooltip" target="_blank" title="Facebook">
                                                    <i class="fa fa-facebook"></i>
                                                </a>
                                            </li>
                                            <li class="instagram">
                                                <a href="https://www.instagram.com/" data-toggle="tooltip" target="_blank" title="Instagram">
                                                    <i class="fa fa-instagram"></i>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                    <!-- Begin Footer Newsletter Area -->
                                    <div class="footer-newsletter">
                                        <h4>Sign up to newsletter</h4>
                                        <form action="#" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="footer-subscribe-form validate" target="_blank" novalidate>
                                           <div id="mc_embed_signup_scroll">
                                              <div id="mc-form" class="mc-form subscribe-form form-group" >
                                                <input id="mc-email" type="email" autocomplete="off" placeholder="Enter your email" />
                                                <button  class="btn" id="mc-submit">Subscribe</button>
                                              </div>
                                           </div>
                                        </form>
                                    </div>
                                    <!-- Footer Newsletter Area End Here -->
                                </div>
                                <!-- Footer Block Area End Here -->
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Footer Static Middle Area End Here -->
                <!-- Begin Footer Static Bottom Area -->
                <div class="footer-static-bottom pt-55 pb-55">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-12">
                                <!-- Begin Copyright Area -->
                                <div class="copyright text-center pt-25">
                                    <span><a target="_blank" href="#">Brought to you by the Official M-Devs</a></span>
                                </div>
                                <!-- Copyright Area End Here -->
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Footer Static Bottom Area End Here -->
            </div>
            <!-- Footer Area End Here -->
            <!-- Footer Area End Here -->
            <!-- Begin Quick View | Modal Area -->
            <div class="modal fade modal-wrapper" id="exampleModalCenter" >
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-body">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                            <div class="modal-inner-area row">
                                <div class="col-lg-5 col-md-6 col-sm-6">
                                   <!-- Product Details Left -->
                                    <div class="product-details-left">
                                        <div class="product-details-images slider-navigation-1">
                                            <div class="lg-image" id="showImage">
                                                
                                            </div>
                                        </div>
                                    </div>
                                    <!--// Product Details Left -->
                                </div>

                                <div class="col-lg-7 col-md-6 col-sm-6">
                                    <div class="product-details-view-content pt-60">
                                        <div class="product-info">
                                            <h2 id="booK_title"></h2>
                                            <div class="price-box pt-20">
                                                <span class="new-price new-price-2" id="book_price"></span>
                                            </div>
                                            <div class="product-desc">
                                                <p>
                                                    <span id="book_description">
                                                    </span>
                                                </p>
                                            </div>
                                            <div class="single-add-to-cart">
                                                <form action="#" class="cart-quantity">
                                                    <div id="buy_book"></div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>   
            <!-- Quick View | Modal Area End Here -->
        </div>
        <!-- Body Wrapper End Here -->
        <script src="<?php echo site_assets() ?>js/jquery.min.js"></script><!--Unused-->
        <!-- jQuery-V1.12.4 -->
        <script src="<?php echo site_assets() ?>js/vendor/jquery-1.12.4.min.js"></script>
        <!-- Popper js -->
        <script src="<?php echo site_assets() ?>js/vendor/popper.min.js"></script>
        <!-- Bootstrap V4.1.3 Fremwork js -->
        <script src="<?php echo site_assets() ?>js/bootstrap.min.js"></script>
        <!-- Ajax Mail js -->
        <script src="<?php echo site_assets() ?>js/ajax-mail.js"></script>
        <!-- Meanmenu js -->
        <script src="<?php echo site_assets() ?>js/jquery.meanmenu.min.js"></script>
        <!-- Wow.min js -->
        <script src="<?php echo site_assets() ?>js/wow.min.js"></script>
        <!-- Slick Carousel js -->
        <script src="<?php echo site_assets() ?>js/slick.min.js"></script>
        <!-- Owl Carousel-2 js -->
        <script src="<?php echo site_assets() ?>js/owl.carousel.min.js"></script>
        <!-- Magnific popup js -->
        <script src="<?php echo site_assets() ?>js/jquery.magnific-popup.min.js"></script>
        <!-- Isotope js -->
        <script src="<?php echo site_assets() ?>js/isotope.pkgd.min.js"></script>
        <!-- Imagesloaded js -->
        <script src="<?php echo site_assets() ?>js/imagesloaded.pkgd.min.js"></script>
        <!-- Mixitup js -->
        <script src="<?php echo site_assets() ?>js/jquery.mixitup.min.js"></script>
        <!-- Countdown -->
        <script src="<?php echo site_assets() ?>js/jquery.countdown.min.js"></script>
        <!-- Counterup -->
        <script src="<?php echo site_assets() ?>js/jquery.counterup.min.js"></script>
        <!-- Waypoints -->
        <script src="<?php echo site_assets() ?>js/waypoints.min.js"></script>
        <!-- Barrating -->
        <script src="<?php echo site_assets() ?>js/jquery.barrating.min.js"></script>
        <!-- Jquery-ui -->
        <script src="<?php echo site_assets() ?>js/jquery-ui.min.js"></script>
        <!-- Venobox -->
        <script src="<?php echo site_assets() ?>js/venobox.min.js"></script>
        <!-- Nice Select js -->
        <script src="<?php echo site_assets() ?>js/jquery.nice-select.min.js"></script>
        <!-- ScrollUp js -->
        <script src="<?php echo site_assets() ?>js/scrollUp.min.js"></script>
        <!-- Chart js -->
        
        <!-- Main/Activator js -->
        <script src="<?php echo site_assets() ?>js/main.js"></script>
        <!-- Cloudflare Web Analytics -->
        <!--<script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "cee9be561f814496b5cdcba0f5976eb9"}'></script>-->
        <!-- End Cloudflare Web Analytics -->
        <!-- FileDownload JS -->
        <script src="<?php echo site_assets() ?>js/jquery.fileDownload.js"></script>

<script type="text/javascript">

    var seconds = 5;
    var time = 0;
    var downloadExecute;
    var payment_confirmation = document.getElementById('payment_confirmation');
    var downloading_status = document.getElementById('downloading_status');
    var manual_download = document.getElementById('manual_download');
    var alt_download = document.getElementById('alt_download');
    var first_time = true;

    var timer;

    function stop_timer() {
        clearInterval(timer);
    }

    $(document).ready(function(){

        $("#alt_download").hide();
        $("#submit").click(function(e){
            e.preventDefault();

            var phone_number = $('#phone_number').val();
            var book_id = $('#book_id').val();
            var amount = $('#price').val();

            var form_data = new FormData($('#buy_form')[0]);
            form_data = phone_number + ":" + amount;

            $.ajax({
                url: '<?php echo site_url() ?>purchase/buy',
                type: 'POST',
                data: {phone_number: phone_number, amount: amount},
                dataType: 'json',
                timeout: 60000,
                beforeSend: function(){

                    $('.loading').addClass(' LockOn');
                    $('#overlay').addClass(' overlay');
                    payment_confirmation.innerHTML = "Sending money request to your mpesa...";
                },
                error: function(jqXHR, textStatus){

                    if (textStatus === 'timeout') {

                        $('.loading').removeClass(' LockOn');
                        $('#overlay').removeClass(' overlay');

                        payment_confirmation.innerHTML = "Unable to send payment request!";

                        report_error(phone_number, 2, 'Money request timeout');
                    }
                },
                success: function(res){

                    if (res.error === false) {

                        time = 0;

                        payment_confirmation.innerHTML = "Confirming your payment. Please wait...";
                        timer = setInterval(check_payment, 1000);

                    } else {
                        //alert user we are unable to complete the process so he/she should try again
                        $('.loading').removeClass(' LockOn');
                        $('#overlay').removeClass(' overlay');
                        
                        report_error(phone_number, 1, 'Money request was not sent');
                        
                    }
                }
            });

        });

        $("#manual_download").click(function(e){
            e.preventDefault();

            var book_id = $('#book_id').val();

            $.ajax({
                url: '<?php echo site_url() ?>purchase/book_download',
                type: 'POST',
                data: {book_id: book_id},
                dataType: 'json',
                error: function(jqXHR, textStatus){

                },
                success: function(res){

                    if (res.error === false) {

                        var location = '/assets/files/books/' + res.file;
                        var file_extension = res.file.split('.').pop();
                        var full_name = res.file_name + "." + file_extension;
                        download_file(location, full_name);
                    } 
                }
            });

        });

    });

    function check_payment() {

        time ++;

        if (time == 75) {

            clearInterval(timer);

            stop_timer();

            var message = 'Payment confirmation timeout';
            var phone_number = $('#phone_number').val();
            report_error(phone_number, 3, message);

            $('.loading').removeClass(' LockOn');
            $('#overlay').removeClass(' overlay');

        } else {

            $.ajax({
                url: '<?php echo site_url() ?>purchase/check_payment',
                type: 'POST',
                processData: false,
                contentType: false,
                error: function(){

                },
                success: function(response){

                    var res = jQuery.parseJSON(response);

                    if (res.error === false) {

                        clearInterval(timer);

                        payment_confirmation.innerHTML = "payment received";

                        $('.loading').removeClass(' LockOn');
                        $('#overlay').removeClass(' overlay');


                        if (first_time === true) {

                            downloadExecute = setInterval(download_book, 1000);

                            first_time = false;
                        }

                    } 
                }
            });

        }
    }

    function download_book() {

        clearInterval(timer);
        
        first_time = false;

        seconds--;

        if(seconds == 0) {

            clearInterval(downloadExecute);
            clearInterval(timer);

            var book_id = $('#book_id').val();

            $.ajax({
                url: '<?php echo site_url() ?>purchase/download_book',
                type: 'POST',
                data: {id : book_id},
                dataType: 'json',
                error: function() {
                    
                },
                success: function(res) {

                    if (res.error === false) {
                        payment_confirmation.innerHTML = "";
                        downloading_status.innerHTML = "";
                        //book was found

                        var file = '<?php echo base_url() ?>/assets/files/books/'+res.file;
                        var location = '/assets/files/books/' + res.file;
                        var file_extension = res.file.split('.').pop();
                        var full_name = res.file_name + "." + file_extension;

                        download_file(location, full_name);

                        $("#alt_download").show();

                        payment_confirmation.innerHTML = "";

                    } else {
                        
                        var message = res.file + ' was not found in the repository';
                        report_error(res.phone_number, 4, message);
                    }
                }
            });

        }

        downloading_status.innerHTML = "Downloading book in " + seconds + " seconds.";

    }

    function report_error(phone_number, error_type, error_message) {

        var data = new FormData();
        data = {phone_number: phone_number, error_type: error_type, error_message: error_message};

        $.ajax({

            url: '<?php echo site_url() ?>purchase/report_error',
            type: 'POST',
            data: data,
            dataType: 'html',
            error: function(){

            },
            success: function(response) {

                var res = jQuery.parseJSON(response);

                if (res.error === false) {
                    downloading_status.innerHTML = res.message;
                }
                
            }
        });
    }

    function book_download(file, file_name){

        var a = document.createElement('a');
        var file_loc = '<?php echo base_url() ?>/assets/files/books/'+file;
        var location = '/assets/files/books/' + file;
        var blob = new Blob([file_loc], { type: "application/octetstream" })
        var url = window.URL || window.webkitURL;
        var link = url.createObjectURL(blob);
        var file_extension = file.split('.').pop();

        a.href = location;
        a.download = file_name + "." + file_extension;
        a.style.display = 'none';
        document.body.appendChild(a);
        a.click();
        delete a;
        window.URL.revokeObjectURL(url);
    }

    function download_file(fileURL, fileName) {
        
        if (!window.ActiveXObject) { // for non-IE
            var save = document.createElement('a');
            save.href = fileURL;
            save.target = '_blank';
            var filename = fileURL.substring(fileURL.lastIndexOf('/')+1);
            save.download = fileName || filename;
            if ( navigator.userAgent.toLowerCase().match(/(ipad|iphone|safari|android)/) && navigator.userAgent.search("Chrome") < 0) {
                document.location = save.href; 
            } else { // window event not working here
                var evt = new MouseEvent('click', {
                    'view': window,
                    'bubbles': true,
                    'cancelable': false
                });
                save.dispatchEvent(evt);
                (window.URL || window.webkitURL).revokeObjectURL(save.href);
            }   
        } else if ( !! window.ActiveXObject && document.execCommand) { // for IE < 11
            var _window = window.open(fileURL, '_blank');
            _window.document.close();
            _window.document.execCommand('SaveAs', true, fileName || fileURL)
            _window.close();
        }
    }

    function checkInternetConnection(){
        var status = navigator.onLine;
        if (status) {
            console.log('Internet Available !!');
        } else {
            console.log('No internet Available !!');
        }  
        setTimeout(function() {
            checkInternetConnection();
        }, 1000);
    }

    function viewDetails(id) {

        var base_url = "<?php echo base_url(); ?>";

        if (id) {

            $.ajax({
                type: 'POST',
                url: base_url + 'home/fetchBook',
                data: {book_id: id},
                dataType: 'json',
                success: function(response){

                    var isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

                    if (!isMobile) {
                        $('#showImage').html('<img src="<?php echo src(); ?>'+response.book_photo+'?auto=format,enhance&fit=crop&w=335&min-h=505"/>');
                    }
                    
                    $('#booK_title').html(response.book_name);
                    $('#book_price').html('KES ' + response.book_price);
                    $('#book_description').html(response.book_description);
                    $('#buy_book').html('<div class="default-btn"><a href="<?php echo site_url() ?>/home/purchase/'+response.book_slug+'" class="links">Buy</a></div>');
                }
            });
        }
    }



</script>
<script>
    

</script>
    </body>

</html>
